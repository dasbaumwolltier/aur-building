pkgname=python-transwhat-git
_pkgname=transwhat
pkgver=v0.2.2.r54.gd022243
pkgrel=2
epoch=1
pkgdesc="A gateway between the XMPP and the WhatsApp IM networks"
arch=('any')
conflicts=('python-transwhat')
provides=('python-transwhat' 'python-spectrum2')
url="https://github.com/stv0g/transwhat"
license=('GPL')
depends=('python' 'python-protobuf' 'python-pillow' 'python-dateutil' 'python-yowsup>=3' 'spectrum2')
makedepends=('git' 'python-setuptools')
options=('!strip' '!emptydirs')
source=('git+https://github.com/stv0g/transwhat/'
        'https://files.pythonhosted.org/packages/d0/2b/e8d3f1a7baa3707ce0d1b67c6caae874c45f3515c830ed85d5464b758dfc/pyspectrum2-0.2.0.tar.gz'
)
md5sums=('SKIP'
         '361997189f2a206776612e3238788363')

pkgver() {
  cd "$srcdir/$_pkgname"
  git describe --long --tags | sed 's/\([^-]*-g\)/r\1/;s/-/./g'
}

prepare() {
  cd "$srcdir/$_pkgname"
  git checkout yowsup-3
}

package() {
  cd "$srcdir/$_pkgname"
  python setup.py install --prefix=/usr --root="$pkgdir" --optimize=1

  find etc/ -type f -exec sh -c "install -Dm644 {} $pkgdir/usr/share/transwhat/example/{}" \;
  find "$pkgdir" -type f -exec sed -i 's#/usr/bin/python2#/usr/bin/python#g' {} \;

  cd "$srcdir/pyspectrum2-0.2.0"
  python setup.py install --prefix=/usr --root="$pkgdir" --optimize=1
}

# disabled for now
#check(){
#  cd "${srcdir}/transwhat-${pkgver}"
#  python2 setup.py test
#}
